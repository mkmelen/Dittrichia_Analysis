---
title: "Seed Behavior"
output: html_notebook
date: March 2023
author: Miranda Melen
contributors: Laura Goetz, Matt Kustra, Julia Harenčár, and Nicky Lustenhouwer
---
#Background
The dataset cox_germ_soil8-2-21.csv has germination rate and germination success data from an experiment conducted at UCSC greenhouses in 2021. Seed was sources from two Habitat types (roadside and soils away from roads), and Treatments were two soil types sourced from UCSC.

To test for differences in germination rate between roadside populations and those invading away from roads, we used a germination experiment, which incorporated two proxy soil types for roadside and soils away from roads.
                                                                                              
In June 2021, we collected construction soil and natural soil from an outdoor storage area at the UC Santa Cruz (UCSC) lower campus. The construction soil, from the UCSC Kresge construction site, was previously processed to road specifications and will be used in building future roads and shoulders around UCSC. The natural soil was topsoil removed from vegetated areas around the construction site and contained a high amount of woody organic matter. We used a 5mm sieve to remove sticks and rocks from both types of soil.

In the summer of 2021, we tested germination behavior on construction and natural soils. We germinated 10 seeds from each population in Petri dishes. We added construction soil or natural soil to 160 Petri dishes (80 Petri dishes per treatment; 5 replicates each). Petri dishes were sealed with parafilm and placed in a randomized block design in an incubation chamber with a daytime temperature of 23ºC from 9AM-1AM and a nighttime temperature of 19ºC from 1AM-9AM. Each day we scored Petri dishes for germination, for a total of 20 days. Signs of germination included the first emergence of the root radical or the cotyledon. Petri dishes were misted with DI water as needed, and germinated seeds were removed once scored.

#Data Analysis
Statistical analyses were performed in R version 4.2.1 (R Core Team 2022) using two-way ANOVA to analyze interactions of habitat and soil type on proportion of germination. We used mixed effects cox models with the coxme (Therneau 2022a) and survival (Therneau 2022b) packages to assess germination rates for each soil type. Germination success was assessed using linear mixed-effects models with the lme4 (Bates et al. 2015), lmerTest (Kuznetsova et al. 2017), and DHARMa packages (Hartig 2022).

##Cox proportional hazard models
Here we will use 'coxme' which allows you to conduct mixed effects Cox proportional hazards models. Information here: https://cran.r-project.org/web/packages/coxme/vignettes/coxme.pdf. We conducted a germination experiment using Dittrichia graveolens seeds on filter paper. "Surv" creates a survival object to combine the days column (NumDaysAlive) and the censor column (Censor) to be used as a response variable in a model formula. The model follows the same syntax as linear models (lm, lmer, etc). Fixed effects: "var1 * var2" will give you the interaction term and the individual variables: so "var1 + var2 + var1:var2". To add random effects, type "+ (1|random effect)". 

#Libraries
```{r}
#install.packages("coxme")
#install.packages("survival")
#install.packages("ggplot2")
#install.packages("ggfortify")
#install.packages("car")
#install.packages("multcomp")
#install.library("tidyverse")
#install.library("dplyr")
#install.library("data.table")
#install.library("emmeans")
library(coxme)
library(survival)
library(ggplot2)
library(ggfortify)
library(car)
library(multcomp)
library(tidyverse)
library(dplyr)
library(data.table)
library(emmeans)
```

#Load Data
This dataframe has one row per seed (1600 observations) with a calculation for how many days it took for the seed to germinate (DaysToGerm). The censor for this dataframe is Censor with a 1 denoting a seed germinated and a 0 denoting when a seed didn't germinate by the last census date (Census = 8/2/21).
```{r}
mydata<-read.csv("/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/data/seed_behavior/cox_germ_soil8-2-21.csv",stringsAsFactors=T)
mydata$DishNum<-as.factor(mydata$DishNum)
str(mydata) #Check that each column has the right class (factor, integer, numeric, etc.)
```

#Histograms
```{r}
#All data
hist(mydata$DaysToGerm,col='steelblue',main='Original')
#By soil type
ggplot(mydata,aes(x=DaysToGerm))+geom_histogram()+facet_wrap(vars(Treatment)) #Here we see that Dittrichia germination responds similarly to both soil types (Treatment).
```

#Cox Model
Start by making a simple model with no random effects. This will be compared to the full model with random effects.
```{r}
simplemodel1<-coxph(Surv(DaysToGerm,Censor)~Habitat*Treatment,data=mydata)
#summary(simplemodel1)
#print(simplemodel1)
#predict(simplemodel1)
hist(predict(simplemodel1))
```

Now make a full model using random effects
```{r}
fullmodel1<-coxme(Surv(DaysToGerm,Censor)~Habitat*Treatment+(1|Site/Population/DishNum),data=mydata)
#summary(fullmodel1)
#print(fullmodel1)
#predict(fullmodel1)
hist(predict(fullmodel1))
```

Now we can compare the models to see which model is best
```{r}
anova(simplemodel1,fullmodel1) #There is a significance between models
AIC(simplemodel1,fullmodel1) #But comparing the AIC scores is easiest. Keep the lower AIC score because that is considered the better model. The full model (fullmodel1) is best
```

Now, let's make a model with no interaction term
```{r}
fullmodel2<-coxme(Surv(DaysToGerm,Censor)~Habitat+Treatment+(1|Site/Population/DishNum),data=mydata) 
summary(fullmodel2)
```

Let's compare the the first two models to test for the significance of the term that is removed (using LR)
```{r}
anova(fullmodel1,fullmodel2) #Not significant
AIC(fullmodel1,fullmodel2) #The two models are within 2 points of each other, so I can use the simpler model, which means the interaction term is dropped and we keep fullmodel2.
```

##Best Model
```{r}
#fullmodel2<-coxme(Surv(DaysToGerm,Censor)~Habitat+Treatment+(1|Site/Population/DishNum),data=mydata) 
summary(fullmodel2)
```

##Risk Assessment
These values are found in the model summary, but if you want to pull them out, here is how you interpret them.
```{r}
#1 = no effect, <1 = decreased risk of death, >1 = increased risk of death.

exp(coef(fullmodel2)) #When we run this, both are just above 1, which means that roadside has an ever so so slight increase in germination compared to off-road, and forest has an even smaller slight increase in germination compared to construction.

#Here we pull the std dev of the random effects which works like the fixed effect coefficients to calculate risk.
exp(ranef(fullmodel2)$Site) # Pretty even among all the sites
```

#ggplot
##Proportion Germinated x Time with Habitat and Treatment (all data pooled) - not used

```{r}
#we want the graph to start at zero, but the data starts on day 2, so here we create fake data for the line to use
fakedata1<-data.frame(Habitat=c("Vegetated","Roadside","Vegetated","Roadside"),
                      Treatment=c("Construction Soil","Field Soil","Field Soil","Construction Soil"),
                      DaysToGerm=c(0),
                      type=c("fake"))

mydata1<-mydata%>%
  filter(DaysToGerm!=0)%>% #our real data has some zeros because some seeds didn't germinate, but we need those to be removed since they are not real zeros
  mutate(type=c("real"))%>% #here we add a column identifies our real
  bind_rows(fakedata1) #now we add our fake data so that we have one dataframe with real and fake data (labeled, of course)
  
germ_rate1<-mydata1%>% 
  mutate(PlotTreatment=paste(Habitat,Treatment,sep="/"))%>% #now we create a new column called PlotTreatment (I don't remember why it is named that), which combines Habitat and Treatment with a / to separate
  group_by(PlotTreatment,type)%>% #here the data is being grouped by PlotTreatment and type (fake or real data)
  count(DaysToGerm)%>% #now we count the number of occurrences for each DaysToGerm 
  mutate(CumulativeSum=cumsum(n))%>% #here we take the cumulative sum of the number we just counted
  mutate(Proportion=CumulativeSum/400) #here we calculate the proportions using 400 seeds per group, 4 groups (2 Habitats x 2 Treatments)

germ_rate1_gg<-ggplot(germ_rate1,#making a graph with ggplot using germ_rate1 data
                      aes(x=DaysToGerm, #variable for x-axis
                          y=Proportion, #variable for y-axis
                          color=PlotTreatment, #how colors should be assigned
                          shape=PlotTreatment))+ #how shapes should be assigned
  geom_line(linewidth=0.5)+ #now we make the line
  geom_point(aes(size=type))+ #now we add the data points
  theme_bw(base_size=16)+ #classic theme and base_size is the font size for labels
  theme(panel.border=element_blank(),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        axis.line=element_line(colour="black"),
        legend.position = c(0.7, 0.4))+
  scale_y_continuous(name="Proportion Germinated", #y-axis: title
                     limits=c(0,1), #y-axis: range
                     breaks=c(0.0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0))+ #y-axis: manual incremental breaks
  scale_x_continuous(name="Days to Germination", #x-axis: title
                     limits=c(0,12), #x-axis: range
                     breaks=seq(0,12,1))+ #x-axis: incremental breaks by giving range and requesting a sequence by 1
  scale_size_manual(values=c(0,5), #second number controls the size of the point
                    guide="none")+
  scale_color_manual(values=c("gray85","gray85","forestgreen","forestgreen"))+ #colors assigned in order of the legend
  scale_shape_manual(values=c(19,17,19,17))+
  labs(y="Proportion Germinated",
       fill="Source Habitat/Soil Type",
       color="Source Habitat/Soil Type",
       shape="Source Habitat/Soil Type")
germ_rate1_gg

#ggsave(plot=germ_rate1_gg,file="/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/figures/germ_rate1_gg.png",width=25,height=15,units="cm",dpi=800)
```

##Proportion Germinated x Time with Habitat and Treatment (data pooled by dish)

```{r}
mydata1<-mydata%>%
  filter(DaysToGerm!=0)%>% #our real data has some zeros because some seeds didn't germinate, but we need those to be removed since they are not real zeros
  mutate(type=c("real")) #here we add a column identifies our real

germ_rate1.0<-mydata1%>% 
  group_by(DishNum,GermDate,Habitat,Treatment,DaysToGerm)%>%
  summarize(NumGerm=n(),PropGerm=NumGerm/10)%>% 
  mutate(PlotTreatment=paste(Habitat,Treatment,sep="/"))%>% #create a new column called PlotTreatment combining Habitat and Treatment with a / to separate
  group_by(DishNum)%>% 
  mutate(CumPropGerm=cumsum(PropGerm))

#make empty data frame to fill with closest or actual number
germ_rate1.1<-data.frame(PlotTreatment="blank",
                      DaysToGerm=c(rep(seq(1,12,1),40)),
                      DishNum=rep(seq(1,160,1),each=12),
                      PropGerm=0,CumPropGerm=0)

germ_rate1.1<-germ_rate1.1%>%
  filter(germ_rate1.1$DishNum%in%germ_rate1.0$DishNum) #actually prefilter dish numbers

#for loop to fill in missing data, may take a bit, warnings are just about making empty data frame
for (i in 1:nrow(germ_rate1.1)){
  #first check if the dish number is in the data set
  if(germ_rate1.1$DishNum[i]%in%germ_rate1.0$DishNum){
    #make temporary data frame of the data set of dish
    temp<-germ_rate1.0%>%
      filter(DishNum==germ_rate1.1$DishNum[i])%>%#first filter for the right dish
      mutate(diff=DaysToGerm-as.numeric(germ_rate1.1$DaysToGerm[i]))
    #now filter for specific day
    filltemp<-temp%>% #subtract day
      filter(diff<=0)%>% #filter for either earlier or same day
      filter(diff==max(diff))#filter for exact match or closest
    if(nrow(filltemp)>0){#check if it is empty data frame, meaning no close day
      germ_rate1.1[i,]<-c(filltemp$PlotTreatment,germ_rate1.1$DaysToGerm[i],germ_rate1.1$DishNum[i],filltemp$PropGerm,filltemp$CumPropGerm)
    }else{
    germ_rate1.1[i,]<-c(temp$PlotTreatment[1],germ_rate1.1$DaysToGerm[i],germ_rate1.1$DishNum[i],0,0)
  }}
  else{#if there is no data for the dish just skip.
    next
  }
}

#we want the graph to start at zero, but the data starts on day 2, so here we create fake data for the line to use
fakedata1<-data.frame(PlotTreatment=c("Roadside/Construction Soil","Roadside/Field Soil","Vegetated/Construction Soil","Vegetated/Field Soil"),
                      DaysToGerm=c(0),
                      DishNum=c(0),
                      PropGerm=c(0),
                      CumPropGerm=c(0),
                      type=c("fake"))

fakedata1$DaysToGerm<-as.character(fakedata1$DaysToGerm)
fakedata1$DishNum<-as.character(fakedata1$DishNum)
fakedata1$PropGerm<-as.character(fakedata1$PropGerm) 
fakedata1$CumPropGerm<-as.character(fakedata1$CumPropGerm)
fakedata1$type<-as.character(fakedata1$type) 

#put real data and fake data together
germ_rate1.2<-germ_rate1.1%>%
  mutate(type=c("real"))%>% #here we add a column to identify our real data
  bind_rows(fakedata1) #now we add our fake data so that we have one dataframe with real and fake data (labeled, of course)

germ_rate1.2$CumPropGerm<-as.numeric(germ_rate1.2$CumPropGerm)

germ_rate1.2<-germ_rate1.2%>% 
  group_by(type,DaysToGerm,PlotTreatment)%>%
  summarize(mean_CumPropGerm=mean(CumPropGerm,
                               na.rm=TRUE),
            sd_prop=sd(CumPropGerm,na.rm=TRUE),
            se_prop=sd_prop/sqrt(40))%>% 
  mutate(DaysToGerm=as.numeric(DaysToGerm))
 
germ_rate1.2_gg<-ggplot(germ_rate1.2, #making a graph with ggplot
                      aes(x=DaysToGerm, #variable for x-axis
                          y=mean_CumPropGerm, #variable for y-axis
                          color=PlotTreatment, #how colors should be assigned
                          shape=PlotTreatment))+ #how shapes should be assigned
  geom_line(linewidth=0.5)+ #now we make the line
  geom_point(aes(size=type))+ #now we add the data points
  geom_errorbar(aes(ymin=mean_CumPropGerm-se_prop,
                    ymax=mean_CumPropGerm+se_prop),
                width=0.2,
                size=0.5,
                color="gray58",
                position=position_dodge(width=0.15,))+
  theme_bw(base_size=16)+ #theme and base_size is the font size for labels
  theme(panel.border=element_blank(),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        axis.line=element_line(colour="black"),
        legend.position = c(0.8, 0.3))+ #position of our legend
  scale_y_continuous(name="Proportion Germinated", #y-axis: title
                     limits=c(0,1), #y-axis: range
                     breaks=c(0.0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0))+ #y-axis: manual incremental breaks
  scale_x_continuous(name="Days to Germination", #x-axis: title
                     limits=c(0,12), #x-axis: range
                     breaks=seq(0,12,1))+ #x-axis: incremental breaks by giving range and requesting a sequence by 1
  scale_size_manual(values=c(0,5), #second number controls the size of the point
                    guide="none")+
  scale_color_manual(values=c("gray85","gray85","forestgreen","forestgreen"))+ #colors assigned in order of the legend
  scale_shape_manual(values=c(19,17,19,17))+
    labs(y="Proportion Germinated",
       fill="Source Habitat/Soil Type",
       color="Source Habitat/Soil Type",
       shape="Source Habitat/Soil Type")
germ_rate1.2_gg

#ggsave(plot=germ_rate1.2_gg,file="/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/figures/germ_rate1.2_gg.png",width=25,height=15,units="cm",dpi=800)
```


##Proportion Germinated x Time with Habitat and Population - not used

```{r eval=FALSE, include=FALSE}
fakedata2<-unique(mydata[c("Population","Treatment")])%>%
  mutate(type="fake",DaysToGerm=0) #we want the graph to start at zero, but the data starts on day 2, so here we create fake data for the line to use

mydata2<-mydata%>%
    filter(DaysToGerm!=0)%>% #our real data has some zeros because some seeds didn't germinate, but we need those to be removed since they are not real zeros
  mutate(type=c("real"))%>% #here we add a column identifies our real
  bind_rows(fakedata2) #now we add our fake data so that we have one dataframe with real and fake data (labeled, of course)

germ_rate2<-mydata2%>% 
  mutate(PlotTreatment=paste(Population,Treatment,sep="/"))%>% #now we create a new column called PlotTreatment (I don't remember why it is named that), which combines Population and Treatment with a / to separate
  group_by(PlotTreatment,type)%>% #here the data is being grouped by PlotTreatment and type (fake or real data)
  count(DaysToGerm)%>% #now we count the number of occurrences for each DaysToGerm 
  mutate(CumulativeSum=cumsum(n)) %>% #here we take the cumulative sum of the number we just counted
  mutate(Proportion=CumulativeSum/50) #here we calculate the proportions using 50 seeds per group

germ_rate2_gg<-ggplot(germ_rate2)+
  geom_line(aes(x=DaysToGerm,
                y=Proportion,
                color=PlotTreatment),
            size=0.5)+ #now we make the line
  geom_point(aes(x=DaysToGerm,
                 y=Proportion,
                 color=PlotTreatment,
                 shape=PlotTreatment,
                 size=type))+ #now we add the data points
  theme_classic(base_size=16)+
  ylim(0,1)+
  scale_y_continuous(name="Proportion Germinated",
                     limits=c(0,1),
                     breaks=c(0.0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0))+
  scale_x_continuous(name="Days to Germination",
                     limits=c(0,12),
                     breaks=seq(0,12,1))+
  scale_size_manual(values=c(0,5),
                    guide="none")+
  scale_shape_manual(values=c(1, 19, 1, 19, 0, 15, 0, 15, # 8 shape numbers in this array
                                2, 17, 2, 17, 5, 23, 5, 23,
                                6, 25, 6, 25, 3, 12, 3, 12,
                                4, 13, 4, 13, 8, 11, 8, 11))+
  scale_color_manual(values=rep(c("forestgreen","forestgreen","gray85","gray85"),
                                times=8))+
  labs(y="Proportion Germinated",
       fill="Source Habitat/Soil Type",
       color="Source Habitat/Soil Type",
       shape="Source Habitat/Soil Type")
germ_rate2_gg #print graph

ggsave(plot=germ_rate2_gg,file="/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/figures/germ_rate2_gg.png",width=25,height=15,units="cm",dpi=800)
```

##Germination Success X Treatment and Habitat
###Interaction Plot - both soils
```{r}
pd<-position_dodge(0)

germ_rate3.0<-mydata%>% 
  group_by(Treatment,Habitat)%>%
  summarise(Mean=mean(PropGermDish),
            SD=sd(PropGermDish),
            N=length(PropGermDish))%>%
  mutate(SE=SD/sqrt(N))

germ_int3.0_gg<-ggplot(data=germ_rate3.0,
                        aes(x=factor(Treatment),
                            y=Mean,
                            shape=Habitat,
                            group=Habitat,
                            color=Habitat))+
  ylab("Proportion Germinated")+
  coord_cartesian(ylim=c(0,1))+
  xlab("")+
  theme_bw(base_size=16)+
  theme(panel.border=element_blank(),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        axis.line=element_line(colour="black"),
        legend.position = c(0.8, 0.4))+
  scale_y_continuous(name="Proportion Germinated",
                     limits=c(0,1),
                     breaks=c(0.0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0))+
  geom_line(size=1,
            position=pd)+
  geom_point(size=5,
             position=pd)+
  scale_color_manual(values=c("gray85","forestgreen"))+
  geom_errorbar(width=0.15,
                position=pd,
                aes(ymin=(Mean-SE),
                    ymax=(Mean+SE)))+
  labs(y="Proportion Germinated",
       fill="Source Habitat",
       color="Source Habitat",
       shape="Source Habitat")
germ_int3.0_gg

#ggsave(plot=germ_int3.0_gg,file="/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/figures/germ_int3.0_gg.png",width=25,height=15,units="cm",dpi=800)
```
###Boxplot

```{r}
germ_success3<-mydata%>% 
  filter(DaysToGerm!=0)%>% 
  #mutate(PlotTreatment=paste(Habitat,Treatment,sep="/"))%>% 
  group_by(Habitat,Treatment)%>% 
  count(DaysToGerm)%>% 
  mutate(CumulativeSum=cumsum(n))%>% 
  mutate(Proportion=CumulativeSum/400) 

germ_success3_gg<-ggplot(germ_success3)+
  geom_boxplot(aes(x=Treatment,y=Proportion),size=0.5)+
  theme_classic(base_size=24)+
  ylim(0,1)+
  labs(y="Proportion Germinated",x="Treatment")
germ_success3_gg

ggsave(plot=germ_success3_gg,file="/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/figures/germ_success3_gg.png",width=20,height=15,units="cm",dpi=800)

#Or using facet_grid
germ_success3F_gg<-ggplot(germ_success3)+
  geom_boxplot(aes(x=Habitat,y=Proportion),size=.5)+
  theme_classic()+
  ylim(0,1)+
  scale_fill_manual(values=c("forestgreen","gray58"))+
  labs(y="Proportion Germinated",x="Habitat")
germ_success3F_gg

ggsave(plot=germ_success3F_gg,file="/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/figures/germ_success3F_gg.png",width=20,height=15,units="cm",dpi=800)
```

###Interaction Plot - field soil only
```{r}
pd<-position_dodge(0)

germ_rate3.1<-mydata%>% 
  filter(Treatment=="Field Soil")%>%
  group_by(Treatment,Habitat)%>%
  summarise(Mean=mean(PropGermDish),
            SD=sd(PropGermDish),
            N=length(PropGermDish))%>%
  mutate(SE=SD/sqrt(N))

germ_int3.1_gg<-ggplot(data=germ_rate3.1,
                        aes(x=factor(Treatment),
                            y=Mean,
                            shape=Habitat,
                            group=Habitat,
                            color=Habitat))+
  ylab("Proportion Germinated")+
  coord_cartesian(ylim=c(0,1))+
  xlab("")+
  theme_bw(base_size=16)+
  theme(panel.border=element_blank(),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        axis.line=element_line(colour="black"),
        legend.position = c(0.8, 0.4))+
  scale_y_continuous(name="Proportion Germinated",
                     limits=c(0,1),
                     breaks=c(0.0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0))+
  geom_line(size=1,
            position=pd)+
  geom_point(size=5,
             position=pd)+
  scale_color_manual(values=c("gray85","forestgreen"))+
  geom_errorbar(width=0.15,
                position=pd,
                aes(ymin=(Mean-SE),
                    ymax=(Mean+SE)))+
  labs(y="Proportion Germinated",
       fill="Source Habitat",
       color="Source Habitat",
       shape="Source Habitat")
germ_int3.1_gg

#ggsave(plot=germ_int3.1_gg,file="/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/figures/germ_int3.1_gg.png",width=25,height=15,units="cm",dpi=800)
```

###Boxplot

```{r}
germ_success1<-mydata%>% 
  filter(DaysToGerm!=0)%>% 
  mutate(PlotTreatment=paste(Habitat,Treatment,sep="/"))%>% 
  group_by(Habitat,Treatment)%>% 
  count(DaysToGerm)%>% 
  mutate(CumulativeSum=cumsum(n))%>% 
  mutate(Proportion=CumulativeSum/400) 

germ_success1_gg<-ggplot(germ_success1)+
  geom_boxplot(aes(x=Treatment,y=Proportion,fill=Habitat),size=0.5)+
  theme_classic()+
  ylim(0,1)+
  scale_fill_manual(values=c("forestgreen","gray58"))+
  labs(y="Proportion Germinated",fill="Habitat",x="Treatment")
germ_success1_gg

ggsave(plot=germ_success1_gg,file="/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/figures/germ_success1_gg.png",width=20,height=20,units="cm",dpi=800)

#Or using facet_grid
germ_success1F_gg<-ggplot(germ_success1)+
  geom_boxplot(aes(x=Treatment,y=Proportion,fill=Habitat),size=.5)+
  theme_classic()+
  ylim(0,1)+
  facet_grid(Habitat~.)+
  scale_fill_manual(values=c("forestgreen","gray58"))+
  labs(y="Proportion Germinated",fill="Habitat",x="Treatment")
germ_success1F_gg

#ggsave(plot=germ_success1F_gg,file="/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/figures/germ_success1F_gg.png",width=20,height=20,units="cm",dpi=800)
```

##Germination Success x Treatment and Population
###Interaction Plot

```{r}
mydata_site_sum<-mydata%>%
  group_by(Habitat,Treatment,Site)%>%
  summarise(Mean=mean(PropGermDish),
            SD=sd(PropGermDish),
            N=length(PropGermDish))%>%
  mutate(SE=SD/sqrt(N))%>%
  mutate(Legend=paste(Site,Habitat,sep="/"))

pd<-position_dodge(0)
germ_int_site_gg<-ggplot(data=mydata_site_sum,
                         aes(x=factor(Treatment),
                             y=Mean,
                             color=Legend,
                             shape=Legend,
                             group=Legend))+
  ylab("Proportion Germinated")+
  coord_cartesian(ylim = c(0,1))+
  xlab("")+
  theme_bw(base_size=16)+
  theme(panel.border=element_blank(),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        axis.line=element_line(colour="black"))+
  scale_y_continuous(name="Proportion Germinated",
                     limits=c(0,1),
                     breaks=c(0.0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0))+
  geom_line(size=.8,
            position=pd)+
  geom_point(size=5,
             position=pd)+
  scale_shape_manual(values=c(19, 19, 15, 15,
                               17, 17, 23, 23,
                               25, 25, 3, 3,
                               4, 4, 8, 8))+
  scale_color_manual(values=rep(c("gray85","forestgreen"),times=16))+
  labs(y="Proportion Germinated",
       color="Population/Source Habitat",
       shape="Population/Source Habitat")+
  geom_errorbar(width=1.2,
                position=pd,
                aes(ymin=(Mean-SE),
                    ymax=(Mean+SE)))
germ_int_site_gg

#ggsave(plot=germ_int_site_gg,file="/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/figures/germ_int_site_gg.png",width=25,height=15,units="cm",dpi=800)
```

###Boxplot
Not using
```{r}
germ_success2<-mydata%>% 
  filter(DaysToGerm!= 0)%>% 
  mutate(PlotTreatment=paste(Habitat,Treatment,sep="/"))%>% 
  group_by(Population,Treatment,Habitat)%>% 
  count(DaysToGerm)%>% 
  mutate(CumulativeSum=cumsum(n))%>% 
  mutate(Proportion=CumulativeSum/50) 

germ_success2_gg<-ggplot(germ_success2)+
  geom_boxplot(aes(x=Treatment,
                   y=Proportion,
                   fill=Population),
               size=0.5)+
  theme_classic()+
  ylim(0,1)+
  facet_grid(Habitat~.)+
  labs(y="Proportion Germinated",
       fill="Population",
       x="Treatment")
germ_success2_gg

#ggsave(plot=germ_success2_gg,file="/Users/Miranda/Documents/Education/UC Santa Cruz/Dittrichia/Dittrichia_Analysis/figures/germ_success2_gg.png",width=20,height=25,units="cm",dpi=800)
```

#Autoplot: Proportion Germinated

Not using

```{r eval=FALSE, include=FALSE}
#Plot by habitat
model_graph1<-survfit(Surv(DaysToGerm,Censor)~
                        Habitat,
                      data=mydata)

autoplot(model_graph1)+
  labs(x="\n Time to Germination (Days)",
       y="Germination Probabilities\n",
       title="Germination Times Of Seeds from \n Roadside and Away Habitats\n")+
  theme(plot.title=element_text(hjust=0.5),
        axis.title.x=element_text(face="bold",
                                  color="Black",
                                  size=12),
        axis.title.y=element_text(face="bold",color="Black",
                                  size=12),
        legend.title=element_text(face="bold",
                                  size=10))

#Plot by habitat and treatment
model_graph2<-survfit(Surv(DaysToGerm,Censor)~
                        Habitat+Treatment,
                      data=mydata)

autoplot(model_graph2)+
  labs(x="\n Time to Germination (Days)",
       y="Germination Probabilities\n",
       title="Germination Times Of Seeds from \n Roadside and Away Habitats\n")+
  theme(plot.title=element_text(hjust=0.5),
        axis.title.x=element_text(face="bold",
                                  color="Black",
                                  size=12),
        axis.title.y=element_text(face="bold",
                                  color="Black",
                                  size=12),
        legend.title=element_text(face="bold",
                                  size=10))

#Plot by site and treatment
model_graph3<-survfit(Surv(DaysToGerm,Censor)~
                        Site+Treatment,
                      data=mydata)

autoplot(model_graph3)+
  labs(x="\n Time to Germination (Days)",
       y="Germination Probabilities\n",
       title="Germination Times Of Seeds from \n Roadside and Away Habitats\n")+
  theme(plot.title=element_text(hjust=0.5),
        axis.title.x=element_text(face="bold",
                                  color="Black",
                                  size=12),
        axis.title.y=element_text(face="bold",
                                  color="Black",
                                  size=12),
        legend.title=element_text(face="bold",
                                  size=10))
```
